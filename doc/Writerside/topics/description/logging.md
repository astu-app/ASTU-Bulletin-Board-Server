# Логгирование
В системе ведется логгирование действий над следующими объектами:
* [объявления](#объявления)
* [файлы](#файлы)
* [категории объявлений](#категории-объявлений)
* [группы пользователей](#группы-пользователей)

Каждая запись лога содержит момент редактирования в часовом поясе сервера приложения.

## Объявления
В системе ведется логгирование полной цепочки изменения объявлений за весь период его жизни.

Логгируются следующие операции:
* [создание](#лог-создания)
* [редактирование](#лог-редактирования)
* [сокрытие](#лог-сокрытия)
* [восстановление скрытого объявления](#лог-восстановление-скрытого-объявления)
* [удаление](#лог-удаления-объявления)

### Лог создания
При создании объявления логгируются следующие данные:
* момент создания
* id объявления
* id создателя
* тип операции "CREATED"

### Лог редактирования
Логгируемые при редактировании объявления данные зависят от произведенных операций.

В лог включаются следующая информация:
* момент редактирования
* id объявления
* id редактора
* новое и старое значение для каждого измененного атрибута в [указанном формате](#формат-лога-редактирования-объекта)
* тип операции "UPDATED"

### Лог сокрытия
При автоматическом сокрытии объявления логгируются следующие данные:
* момент сокрытия
* id объявления
* тип операции "HIDDEN AUTOMATICALLY" 

При ручном сокрытии объявления логгируются следующие данные:
* момент сокрытия
* id объявления
* id скрывшего пользователя
* тип операции "HIDDEN MANUALLY"

### Лог восстановление скрытого объявления
При автоматическом восстановлении скрытого объявления логгируются следующие данные:
* момент восстановления
* id объявления
* тип операции "RESTORED MANUALLY"

При ручном восстановлении скрытого объявления логгируются следующие данные:
* момент восстановления
* id объявления
* id восстановившего пользователя
* тип операции "RESTORED AUTOMATICALLY"

### Лог удаления объявления
При удалении скрытого объявления логгируются следующие данные:
* момент удаления
* id объявления
* id удалившего пользователя
* тип операции "DELETED"



## Файлы
В системе ведется логгирование следующих операций над файлами:
* [первичная загрузка файла](#лог-первичной-загрузки)
* [повторная загрузка файла](#лог-повторной-загрузки)
* [удаление файла с сервера](#лог-удаления-файла)

### Лог первичной загрузки
При первичной загрузке файла на сервер логгируются следующие данные:
* момент окончания загрузки файла на сервер
* id файла
* id загрузившего пользователя
* тип операции "UPLOADED"

### Лог повторной загрузки
При попытке повторной загрузки файла на сервер ведется логгирование следующих данных:
* момент попытки повторной загрузки файла
* id оригинального файла
* id совершившего попытку пользователя
* тип операции "RE-UPLOAD TRY"

### Лог удаления файла
При попытке удаления файла с сервера логгируются следующие данные:
* момент удаления файла с сервера
* id файла
* тип операции "DELETED"



## Категории объявлений
Для категорий объявлений ведется логгирование следующих операций:
* [создание](#лог-создания-категории-объявлений)
* [редактирование](#лог-редактирования-категории-объявлений)
* [удаление](#лог-удаления-категории-объявлений)

### Лог создания категории объявлений
При создании категории объявлений логгируются следующие данные:
* момент создания
* id создавшего пользователя
* тип операции "CREATED"

### Лог редактирования категории объявлений
При редактировании категории объявлений логгируются следующие данные:
* момент редактирования
* id отредактировавшего пользователя
* новое и старое значение для каждого измененного атрибута в [указанном формате](#формат-лога-редактирования-объекта)
* тип операции "UPDATED"

### Лог удаления категории объявлений
При удалении категории объявлений логгируются следующие данные:
* момент удаления
* id удалившего пользователя
* тип операции "DELETED"



## Группы пользователей
Для групп пользователей ведется логгирование следующих операций:
* [создание](#лог-создания-группы-пользователей)
* [редактирование](#лог-редактирования-группы-пользователей)
* [удаление](#лог-удаления-группы-пользователей)

### Лог создания группы пользователей
При создании группы пользователей логгируются следующие данные:
* момент создания
* id создавшего пользователя
* тип операции "CREATED"

### Лог редактирования группы пользователей
При редактировании группы пользователей логгируются следующие данные:
* момент редактирования
* id отредактировавшего пользователя
* id отредактированного объявления
* новое и старое значение для каждого измененного атрибута в [указанном формате](#формат-лога-редактирования-объекта) 
* тип операции "UPDATED"

### Лог удаления группы пользователей
При удалении группы пользователей логгируются следующие данные:
* момент удаления
* id удалившего пользователя
* id удаленного объявления
* тип операции "DELETED"



[//]: # (todo лог опросов)
[//]: # (todo лог пользователей)



## Формат лога редактирования объекта
В базе данных лог редактирования объекта записывается в формате json в следующем виде:
```json
{
  "updated_attribute_name": {
    "old_value": "*old val*",
    "new_value": "*new val*"
  },
  "attribute_with_given_value_name": {
    "old_value": null,
    "new_value": "*new val*"
  },
  "attribute_with_deleted_value_name": {
    "old_value": "*old val*",
    "new_value": null
  }
}
```
updated_attribute_name, attribute_with_given_value_name, attribute_with_deleted_value_name - атрибуты с 
отредактированным значением.

При первом задании значения атрибута в old_value содержится null, а в new_value - заданное значение 
(attribute_with_given_value_name).

При удалении значения атрибута в old_value содержится удаленное значение, а в new_value - null 
(attribute_with_deleted_value_name).

