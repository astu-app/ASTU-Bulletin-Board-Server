# Файл

## Сведения

Файл представляет собой файл любого формата. Файл в системе хранится в бинарном виде.

Пользователь имеет возможность загрузить в систему любое количество файлов, но размер каждого загружаемого файла
ограничивается значением из конфигурационного файла. При загрузке файла производится вычисление и поиск его хэша в базе
данных, в случае отсутствия хэша файл загружается, в случае наличия происходит увеличение количества его ссылок.

## Свойства

Файл содержит следующие свойства:

- [Название](#название)
- [Содержимое](#содержимое)
- [Хэш](#хэш)
- [Количество ссылок](#количество-ссылок)

### Название

Название файла может состоять из любых символов Unicode за исключением запрещенных символов. Максимальная длина - 255
символов.

Символы, использование которых в названии файла запрещено:

- зарезервированные символы:
    - < (меньше чем)
    - \> (больше чем)
    - : (двоеточие)
    - " (двойная кавычка)
    - / (косая черта)
    - \\ (обратная косая черта)
    - | (вертикальная полоса или канал)
    - ? (вопросительный знак)
    -
        * (звездочка)
- символы, целочисленное значение которых лежит в диапазоне от 0 до 31 включительно.

### Содержимое

Содержимое файла представлено самим файлом, расположенном в файловой системе или в хранилище бинарных файлов.

### Хэш

При загрузке файла в систему производится вычисление хэша его названия, метаданных бинарного содержимого функцией %%
todo продумать, какую хэш-функцию использовать %%. После вычисления хэша проверяется его наличие в базе данных. В случае
наличия файл загружается, иначе - загрузка не выполняется.

После загрузки файл прикрепляется к указанному объявлению и счетчик ссылок файла увеличивается на количество,
соответствующее количеству прикреплений файла к указанному объявлению.

### Количество ссылок

Количество ссылок отражает количество прикреплений файлов к объявлениям. При каждом прикреплении файл к объявлению число
ссылок файла увеличивается на 1, при каждом откреплении - уменьшается на 1. При достижении количеством ссылок нуля
запускается таймер, не раньше чем по окончании которого файл будет удален из хранилища.

## Связи

Файл связан с одной сущностью - "[Объявление](#объявление)"

### Объявление

См. [описание связи объявления с файлом](notification.md#файл).


